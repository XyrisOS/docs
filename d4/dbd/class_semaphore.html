<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Xyris: Semaphore Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xyris
   &#160;<span id="projectnumber">0.5</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d4/dbd/class_semaphore.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle">
<div class="title">Semaphore Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../d1/d5a/semaphore_8hpp_source.html">semaphore.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for Semaphore:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../da/d0d/class_semaphore__coll__graph.png" border="0" usemap="#_semaphore_coll__map" alt="Collaboration graph"/></div>
<map name="_semaphore_coll__map" id="_semaphore_coll__map">
<area shape="rect" title=" " alt="" coords="5,288,101,315"/>
<area shape="rect" href="../../dd/dc4/structtask__sync.html" title=" " alt="" coords="10,199,97,225"/>
<area shape="rect" href="../../db/da2/structtask.html" title=" " alt="" coords="28,5,79,32"/>
<area shape="rect" href="../../df/d8a/structtasklist.html" title=" " alt="" coords="126,109,197,136"/>
</map>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a0dcd5807621b88d1a506e0668075b802"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/dbd/class_semaphore.html#a0dcd5807621b88d1a506e0668075b802">Semaphore</a> (uint32_t val, bool share, const char *name=nullptr)</td></tr>
<tr class="separator:a0dcd5807621b88d1a506e0668075b802"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a633658a6fde276bffc912028725c6ade"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/dbd/class_semaphore.html#a633658a6fde276bffc912028725c6ade">~Semaphore</a> ()</td></tr>
<tr class="separator:a633658a6fde276bffc912028725c6ade"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3b3b6cd0044efda8fbd2dbd0fb6d995"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/dbd/class_semaphore.html#ac3b3b6cd0044efda8fbd2dbd0fb6d995">Wait</a> ()</td></tr>
<tr class="separator:ac3b3b6cd0044efda8fbd2dbd0fb6d995"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acffb276432a0b992ca4564d0ab0d33a4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/dbd/class_semaphore.html#acffb276432a0b992ca4564d0ab0d33a4">TryWait</a> ()</td></tr>
<tr class="separator:acffb276432a0b992ca4564d0ab0d33a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84ec9a32339cdc71d06cb5e5cf477d06"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/dbd/class_semaphore.html#a84ec9a32339cdc71d06cb5e5cf477d06">TimedWait</a> (const uint32_t *usec)</td></tr>
<tr class="separator:a84ec9a32339cdc71d06cb5e5cf477d06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3035df6c720616bb1c194730d895c924"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/dbd/class_semaphore.html#a3035df6c720616bb1c194730d895c924">Post</a> ()</td></tr>
<tr class="separator:a3035df6c720616bb1c194730d895c924"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4404d1eda77fe45934716a410d1937ca"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/dbd/class_semaphore.html#a4404d1eda77fe45934716a410d1937ca">Count</a> (uint32_t *val)</td></tr>
<tr class="separator:a4404d1eda77fe45934716a410d1937ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a0dc2c888f5a2044bc146eadbc724c4e5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/dbd/class_semaphore.html#a0dc2c888f5a2044bc146eadbc724c4e5">shared</a></td></tr>
<tr class="separator:a0dc2c888f5a2044bc146eadbc724c4e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c735ac721eaad04681acecfaf08aedf"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/dbd/class_semaphore.html#a4c735ac721eaad04681acecfaf08aedf">count</a></td></tr>
<tr class="separator:a4c735ac721eaad04681acecfaf08aedf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7deaab2f8158856137939c014bb2c37"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../dd/dc4/structtask__sync.html">task_sync</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/dbd/class_semaphore.html#aa7deaab2f8158856137939c014bb2c37">task_sync</a></td></tr>
<tr class="separator:aa7deaab2f8158856137939c014bb2c37"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="../../d1/d5a/semaphore_8hpp_source.html#l00016">16</a> of file <a class="el" href="../../d1/d5a/semaphore_8hpp_source.html">semaphore.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a0dcd5807621b88d1a506e0668075b802"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0dcd5807621b88d1a506e0668075b802">&#9670;&nbsp;</a></span>Semaphore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Semaphore::Semaphore </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>share</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes a semaphore struct using the values defined. Semaphores are used in order to maintain mutual exclusion when multiple threads need to access a particular variable. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">val</td><td>Initialized value (how many times must the semaphore be accessed at the beginning before locking?) </td></tr>
    <tr><td class="paramname">share</td><td>Boolean value indicating whether the semaphore should be shared amongst threads or will be used within one thread exclusively. </td></tr>
    <tr><td class="paramname">name</td><td><a class="el" href="../../d4/dbd/class_semaphore.html">Semaphore</a> name (for debugging / printing) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../da/d20/semaphore_8cpp_source.html#l00035">35</a> of file <a class="el" href="../../da/d20/semaphore_8cpp_source.html">semaphore.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    : <a class="code" href="../../d4/dbd/class_semaphore.html#a0dc2c888f5a2044bc146eadbc724c4e5">shared</a>(share)</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    , <a class="code" href="../../d4/dbd/class_semaphore.html#a4c735ac721eaad04681acecfaf08aedf">count</a>(val)</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;{</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="../../dd/dc4/structtask__sync.html">task_sync</a>.<a class="code" href="../../dd/dc4/structtask__sync.html#a89cc556553145f650472b59f883e6ebd">dbg_name</a> = <a class="code" href="../../db/da2/structtask.html#a83a6cca985649416b9cbb05a39b8d3f2">name</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    tasks_sync_init(&amp;<a class="code" href="../../dd/dc4/structtask__sync.html">task_sync</a>);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a633658a6fde276bffc912028725c6ade"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a633658a6fde276bffc912028725c6ade">&#9670;&nbsp;</a></span>~Semaphore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Semaphore::~Semaphore </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destroys a semaphore by removing it from memory. </p>

<p class="definition">Definition at line <a class="el" href="../../da/d20/semaphore_8cpp_source.html#l00043">43</a> of file <a class="el" href="../../da/d20/semaphore_8cpp_source.html">semaphore.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// Nothing to destruct</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a4404d1eda77fe45934716a410d1937ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4404d1eda77fe45934716a410d1937ca">&#9670;&nbsp;</a></span>Count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Semaphore::Count </td>
          <td>(</td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>val</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets the counter value from a semaphore structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">val</td><td>Pointer to the semaphore value variable </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on success and -1 on failure. When an error occurs errno is set. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../da/d20/semaphore_8cpp_source.html#l00107">107</a> of file <a class="el" href="../../da/d20/semaphore_8cpp_source.html">semaphore.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;{</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    __atomic_load(&amp;<a class="code" href="../../d4/dbd/class_semaphore.html#a4c735ac721eaad04681acecfaf08aedf">count</a>, val, __ATOMIC_ACQUIRE);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3035df6c720616bb1c194730d895c924"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3035df6c720616bb1c194730d895c924">&#9670;&nbsp;</a></span>Post()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Semaphore::Post </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Increments the semaphore's counter. This is used to indicate that the thread or process is done utilizing the reference variable and that it is available for use. </p>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on success and -1 on failure. When an error occurs errno is set. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../da/d20/semaphore_8cpp_source.html#l00100">100</a> of file <a class="el" href="../../da/d20/semaphore_8cpp_source.html">semaphore.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;{</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    __atomic_fetch_add(&amp;<a class="code" href="../../d4/dbd/class_semaphore.html#a4c735ac721eaad04681acecfaf08aedf">count</a>, 1, __ATOMIC_RELEASE);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="../../d2/dbd/tasks_8hpp.html#a5dc14e36eb87557e7c264d8596f37b55">TASK_ONLY</a> <a class="code" href="../../d5/d9d/tasks_8cpp.html#a95269b08443b913d1ca443794e4aa3ad">tasks_sync_unblock</a>(&amp;<a class="code" href="../../dd/dc4/structtask__sync.html">task_sync</a>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;}</div>
</div><!-- fragment --><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d4/dbd/class_semaphore_a3035df6c720616bb1c194730d895c924_cgraph.png" border="0" usemap="#d4/dbd/class_semaphore_a3035df6c720616bb1c194730d895c924_cgraph" alt=""/></div>
<map name="d4/dbd/class_semaphore_a3035df6c720616bb1c194730d895c924_cgraph" id="d4/dbd/class_semaphore_a3035df6c720616bb1c194730d895c924_cgraph">
<area shape="rect" title="Increments the semaphore&#39;s counter. This is used to indicate that the thread or process is done utili..." alt="" coords="5,5,137,32"/>
<area shape="rect" href="../../d5/d9d/tasks_8cpp.html#a95269b08443b913d1ca443794e4aa3ad" title=" " alt="" coords="185,5,337,32"/>
</map>
</div>

</div>
</div>
<a id="a84ec9a32339cdc71d06cb5e5cf477d06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84ec9a32339cdc71d06cb5e5cf477d06">&#9670;&nbsp;</a></span>TimedWait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Semaphore::TimedWait </td>
          <td>(</td>
          <td class="paramtype">const uint32_t *&#160;</td>
          <td class="paramname"><em>usec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Functionally the same as sem_wait but with a timeout. This timeout does not mean that within the given period of time the semaphore will be unlocked but rather that after the timeout period the thread or process will unblock and may resume execution without access to the semaphore's reference variable. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">usec</td><td>Microseconds to wait until resuming execution without access to the semaphore's intended reference variable. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on success and -1 on failure. When an error occurs errno is set. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../da/d20/semaphore_8cpp_source.html#l00082">82</a> of file <a class="el" href="../../da/d20/semaphore_8cpp_source.html">semaphore.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;{</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// TODO: Add the timer functionality here.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    (void)usec;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// Used to store the current value of the semaphore for atomic comparison later.</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    uint32_t curVal = <a class="code" href="../../d4/dbd/class_semaphore.html#a4c735ac721eaad04681acecfaf08aedf">count</a>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// Compare the semaphore&#39;s current value to the value recorded earlier.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// If the semaphore counter is already 0 then just skip the compare and exhange.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">while</span> (curVal == 0) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            curVal = <a class="code" href="../../d4/dbd/class_semaphore.html#a4c735ac721eaad04681acecfaf08aedf">count</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="comment">// Fail using atomic relaxed because it may allow us to get to the &quot;waiting&quot; state faster.</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    } <span class="keywordflow">while</span> (!<a class="code" href="../../da/d20/semaphore_8cpp.html#a80bfcf34f6237c6e9458164649f1de22">COMPARE_EXCHANGE</a>(curVal, __ATOMIC_ACQUIRE));</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// Return success</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="acffb276432a0b992ca4564d0ab0d33a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acffb276432a0b992ca4564d0ab0d33a4">&#9670;&nbsp;</a></span>TryWait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Semaphore::TryWait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Functionally the same as sem_wait except that instead of blocking when the semaphore is locked, errno is set instead. </p>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on success and -1 on failure. When an error occurs errno is set. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../da/d20/semaphore_8cpp_source.html#l00065">65</a> of file <a class="el" href="../../da/d20/semaphore_8cpp_source.html">semaphore.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// Used to store the current value of the semaphore for atomic comparison later.</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    uint32_t curVal = <a class="code" href="../../d4/dbd/class_semaphore.html#a4c735ac721eaad04681acecfaf08aedf">count</a>;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// Compare the semaphore&#39;s current value to the value recorded earlier.</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">// If the semaphore counter is already 0 then just skip the compare and exhange.</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keywordflow">if</span> (curVal == 0) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <a class="code" href="../../d1/db0/errno_8cpp.html#a12fb8fb93daa6bae8152a8ec8314cbaa">errno</a> = <a class="code" href="../../d7/dae/errno_8hpp.html#a82793c1b9a6e2dcb6ebce9828aa9e89cab6209f787f748c204a156f7fc11095fd">LockTaken</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="comment">// We need to fail on an Atomic Acquire Release because it will fail less often (i.e. fewer loop iterations)</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    } <span class="keywordflow">while</span> (!<a class="code" href="../../da/d20/semaphore_8cpp.html#a80bfcf34f6237c6e9458164649f1de22">COMPARE_EXCHANGE</a>(curVal, __ATOMIC_ACQUIRE));</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// To get here the semaphore must not have been locked.</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac3b3b6cd0044efda8fbd2dbd0fb6d995"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3b3b6cd0044efda8fbd2dbd0fb6d995">&#9670;&nbsp;</a></span>Wait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Semaphore::Wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Waiting on a semaphore decrements the count value. When a count value is 0, the semaphore is locked and the process or thread must sleep and wait until the semaphore is unlocked by calling post. </p>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on success and -1 on failure When an error occurs errno is set. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../da/d20/semaphore_8cpp_source.html#l00048">48</a> of file <a class="el" href="../../da/d20/semaphore_8cpp_source.html">semaphore.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;{</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">// Used to store the current value of the semaphore for atomic comparison later.</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    uint32_t curVal = <a class="code" href="../../d4/dbd/class_semaphore.html#a4c735ac721eaad04681acecfaf08aedf">count</a>;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// Compare the semaphore&#39;s current value to the value recorded earlier.</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">// If the semaphore counter is already 0 then just skip the compare and exhange.</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="keywordflow">while</span> (curVal == 0) {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            <a class="code" href="../../d2/dbd/tasks_8hpp.html#a5dc14e36eb87557e7c264d8596f37b55">TASK_ONLY</a> <a class="code" href="../../d5/d9d/tasks_8cpp.html#a2432c50b4d4264b5d5295bdb4f19e0d2">tasks_sync_block</a>(&amp;<a class="code" href="../../dd/dc4/structtask__sync.html">task_sync</a>);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;            curVal = <a class="code" href="../../d4/dbd/class_semaphore.html#a4c735ac721eaad04681acecfaf08aedf">count</a>;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="comment">// Fail using atomic relaxed because it may allow us to get to the &quot;waiting&quot; state faster.</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    } <span class="keywordflow">while</span> (!<a class="code" href="../../da/d20/semaphore_8cpp.html#a80bfcf34f6237c6e9458164649f1de22">COMPARE_EXCHANGE</a>(curVal, __ATOMIC_RELAXED));</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// Return success</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;}</div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d4/dbd/class_semaphore_ac3b3b6cd0044efda8fbd2dbd0fb6d995_cgraph.png" border="0" usemap="#d4/dbd/class_semaphore_ac3b3b6cd0044efda8fbd2dbd0fb6d995_cgraph" alt=""/></div>
<map name="d4/dbd/class_semaphore_ac3b3b6cd0044efda8fbd2dbd0fb6d995_cgraph" id="d4/dbd/class_semaphore_ac3b3b6cd0044efda8fbd2dbd0fb6d995_cgraph">
<area shape="rect" title="Waiting on a semaphore decrements the count value. When a count value is 0, the semaphore is locked a..." alt="" coords="5,5,139,32"/>
<area shape="rect" href="../../d5/d9d/tasks_8cpp.html#a2432c50b4d4264b5d5295bdb4f19e0d2" title=" " alt="" coords="187,5,323,32"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Field Documentation</h2>
<a id="a4c735ac721eaad04681acecfaf08aedf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c735ac721eaad04681acecfaf08aedf">&#9670;&nbsp;</a></span>count</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t Semaphore::count</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d5a/semaphore_8hpp_source.html#l00093">93</a> of file <a class="el" href="../../d1/d5a/semaphore_8hpp_source.html">semaphore.hpp</a>.</p>

</div>
</div>
<a id="a0dc2c888f5a2044bc146eadbc724c4e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0dc2c888f5a2044bc146eadbc724c4e5">&#9670;&nbsp;</a></span>shared</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool Semaphore::shared</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d5a/semaphore_8hpp_source.html#l00092">92</a> of file <a class="el" href="../../d1/d5a/semaphore_8hpp_source.html">semaphore.hpp</a>.</p>

</div>
</div>
<a id="aa7deaab2f8158856137939c014bb2c37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7deaab2f8158856137939c014bb2c37">&#9670;&nbsp;</a></span>task_sync</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/dc4/structtask__sync.html">task_sync</a> Semaphore::task_sync</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d5a/semaphore_8hpp_source.html#l00094">94</a> of file <a class="el" href="../../d1/d5a/semaphore_8hpp_source.html">semaphore.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="../../d1/d5a/semaphore_8hpp_source.html">semaphore.hpp</a></li>
<li><a class="el" href="../../da/d20/semaphore_8cpp_source.html">semaphore.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aerrno_8cpp_html_a12fb8fb93daa6bae8152a8ec8314cbaa"><div class="ttname"><a href="../../d1/db0/errno_8cpp.html#a12fb8fb93daa6bae8152a8ec8314cbaa">errno</a></div><div class="ttdeci">enum KernelError errno</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db0/errno_8cpp_source.html#l00015">errno.cpp:15</a></div></div>
<div class="ttc" id="astructtask__sync_html_a89cc556553145f650472b59f883e6ebd"><div class="ttname"><a href="../../dd/dc4/structtask__sync.html#a89cc556553145f650472b59f883e6ebd">task_sync::dbg_name</a></div><div class="ttdeci">const char * dbg_name</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dbd/tasks_8hpp_source.html#l00058">tasks.hpp:58</a></div></div>
<div class="ttc" id="aerrno_8hpp_html_a82793c1b9a6e2dcb6ebce9828aa9e89cab6209f787f748c204a156f7fc11095fd"><div class="ttname"><a href="../../d7/dae/errno_8hpp.html#a82793c1b9a6e2dcb6ebce9828aa9e89cab6209f787f748c204a156f7fc11095fd">LockTaken</a></div><div class="ttdeci">@ LockTaken</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dae/errno_8hpp_source.html#l00018">errno.hpp:18</a></div></div>
<div class="ttc" id="astructtask__sync_html"><div class="ttname"><a href="../../dd/dc4/structtask__sync.html">task_sync</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dbd/tasks_8hpp_source.html#l00055">tasks.hpp:55</a></div></div>
<div class="ttc" id="aclass_semaphore_html_a0dc2c888f5a2044bc146eadbc724c4e5"><div class="ttname"><a href="../../d4/dbd/class_semaphore.html#a0dc2c888f5a2044bc146eadbc724c4e5">Semaphore::shared</a></div><div class="ttdeci">bool shared</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/semaphore_8hpp_source.html#l00092">semaphore.hpp:92</a></div></div>
<div class="ttc" id="atasks_8cpp_html_a95269b08443b913d1ca443794e4aa3ad"><div class="ttname"><a href="../../d5/d9d/tasks_8cpp.html#a95269b08443b913d1ca443794e4aa3ad">tasks_sync_unblock</a></div><div class="ttdeci">void tasks_sync_unblock(struct task_sync *ts)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d9d/tasks_8cpp_source.html#l00574">tasks.cpp:574</a></div></div>
<div class="ttc" id="atasks_8hpp_html_a5dc14e36eb87557e7c264d8596f37b55"><div class="ttname"><a href="../../d2/dbd/tasks_8hpp.html#a5dc14e36eb87557e7c264d8596f37b55">TASK_ONLY</a></div><div class="ttdeci">#define TASK_ONLY</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dbd/tasks_8hpp_source.html#l00046">tasks.hpp:46</a></div></div>
<div class="ttc" id="aclass_semaphore_html_a4c735ac721eaad04681acecfaf08aedf"><div class="ttname"><a href="../../d4/dbd/class_semaphore.html#a4c735ac721eaad04681acecfaf08aedf">Semaphore::count</a></div><div class="ttdeci">uint32_t count</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/semaphore_8hpp_source.html#l00093">semaphore.hpp:93</a></div></div>
<div class="ttc" id="astructtask_html_a83a6cca985649416b9cbb05a39b8d3f2"><div class="ttname"><a href="../../db/da2/structtask.html#a83a6cca985649416b9cbb05a39b8d3f2">task::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dbd/tasks_8hpp_source.html#l00040">tasks.hpp:40</a></div></div>
<div class="ttc" id="atasks_8cpp_html_a2432c50b4d4264b5d5295bdb4f19e0d2"><div class="ttname"><a href="../../d5/d9d/tasks_8cpp.html#a2432c50b4d4264b5d5295bdb4f19e0d2">tasks_sync_block</a></div><div class="ttdeci">void tasks_sync_block(struct task_sync *ts)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d9d/tasks_8cpp_source.html#l00559">tasks.cpp:559</a></div></div>
<div class="ttc" id="asemaphore_8cpp_html_a80bfcf34f6237c6e9458164649f1de22"><div class="ttname"><a href="../../da/d20/semaphore_8cpp.html#a80bfcf34f6237c6e9458164649f1de22">COMPARE_EXCHANGE</a></div><div class="ttdeci">#define COMPARE_EXCHANGE(curVal, failure_memorder)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d20/semaphore_8cpp_source.html#l00027">semaphore.cpp:27</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d4/dbd/class_semaphore.html">Semaphore</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
